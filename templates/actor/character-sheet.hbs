<form class="{{cssClass}} flexcol" autocomplete="off">
  
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile" src="{{actor.img}}" data-action="showImage" title="{{actor.name}}" alt="{{actor.name}}"/>
    
    <div class="header-details flexcol">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
      </h1>
      
      <div class="header-fields flexrow">
        <div class="header-field">
          <label>{{localize "VAGABOND.Character.Ancestry"}}</label>
          <input type="text" name="system.ancestry" value="{{system.ancestry}}" placeholder="Ancestry"/>
        </div>
        
        <div class="header-field">
          <label>{{localize "VAGABOND.Character.Class"}}</label>
          <input type="text" name="system.class" value="{{system.class}}" placeholder="Class"/>
        </div>
        
        <div class="header-field">
          <label>{{localize "VAGABOND.Character.Level"}}</label>
          <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" min="1"/>
        </div>
        
        <div class="header-field">
          <label>{{localize "VAGABOND.Character.XP"}}</label>
          <input type="number" name="system.xp" value="{{system.xp}}" data-dtype="Number" min="0"/>
        </div>
      </div>
      
      <div class="resources flexrow">
        <div class="resource hp">
          <label>{{localize "VAGABOND.Combat.HP"}}</label>
          <input type="number" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number" min="0"/>
          <span class="sep">/</span>
          <span class="max">{{system.hp.max}}</span>
        </div>
        
        <div class="resource luck">
          <label>{{localize "VAGABOND.Stats.Luck"}}</label>
          <input type="number" name="system.luck.value" value="{{system.luck.value}}" data-dtype="Number" min="0"/>
          <span class="sep">/</span>
          <span class="max">{{system.luck.max}}</span>
        </div>
        
        {{#if system.mana.max}}
        <div class="resource mana">
          <label>{{localize "VAGABOND.Magic.Mana"}}</label>
          <input type="number" name="system.mana.value" value="{{system.mana.value}}" data-dtype="Number" min="0"/>
          <span class="sep">/</span>
          <span class="max">{{system.mana.max}}</span>
        </div>
        {{/if}}
        
        <div class="resource">
          <label>{{localize "VAGABOND.Character.Fatigue"}}</label>
          <input type="number" name="system.fatigue" value="{{system.fatigue}}" data-dtype="Number" min="0" max="5"/>
        </div>
      </div>
    </div>
  </header>

  {{!-- Sheet Navigation Tabs --}}
  <nav class="sheet-navigation tabs" data-group="primary">
    {{#each tabs}}
    <a class="item{{#if active}} active{{/if}}" data-tab="{{id}}">{{localize label}}</a>
    {{/each}}
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    
    {{!-- Stats Tab --}}
    <div class="tab{{#if (eq tabGroups.primary "stats")}} active{{/if}}" data-group="primary" data-tab="stats">
      <h2>{{localize "VAGABOND.Tabs.Stats"}}</h2>
      
      <div class="stats-grid">
        {{#each system.stats as |stat key|}}
        <div class="stat" data-stat="{{key}}">
          <label>{{localize (concat "VAGABOND.Stats." key)}}</label>
          <input type="number" name="system.stats.{{key}}.value" value="{{stat.value}}" data-dtype="Number" min="2" max="7"/>
        </div>
        {{/each}}
      </div>
      
      <h3>{{localize "VAGABOND.Tabs.Skills"}}</h3>
      <div class="saves-grid">
        {{#each system.saves as |save key|}}
        <div class="save">
          <label>{{localize (lookup ../config.saves key "label")}}</label>
          <div class="difficulty">{{save.value}}</div>
          <button type="button" data-action="rollCheck" data-check-type="save" data-check-key="{{key}}">
            <i class="fas fa-dice-d20"></i> Roll
          </button>
        </div>
        {{/each}}
      </div>
      
      <h3>Speed & Movement</h3>
      <div class="flexrow">
        <div class="resource">
          <label>Speed</label>
          <span class="max">{{system.speed.base}} ft</span>
        </div>
        <div class="resource">
          <label>Crawl</label>
          <span class="max">{{system.speed.crawl}} ft</span>
        </div>
        <div class="resource">
          <label>Travel</label>
          <span class="max">{{system.speed.travel}} mi</span>
        </div>
      </div>
    </div>

    {{!-- Skills Tab --}}
    <div class="tab{{#if (eq tabGroups.primary "skills")}} active{{/if}}" data-group="primary" data-tab="skills">
      <h2>{{localize "VAGABOND.Tabs.Skills"}}</h2>
      
      <div class="skills-list">
        {{#each system.skills as |skill key|}}
        <div class="skill{{#if skill.trained}} trained{{/if}}">
          <label>{{localize (lookup ../config.skills key "label")}}</label>
          
          <span class="stat-abbr">{{localize (concat "VAGABOND.Stats." skill.stat "Abbr")}}</span>
          
          <div class="trained-toggle">
            <input type="checkbox" name="system.skills.{{key}}.trained" {{checked skill.trained}}/>
            <label>{{localize "VAGABOND.Trained"}}</label>
          </div>
          
          <div class="difficulty">
            {{calculateDifficulty (lookup ../system.stats skill.stat "value") skill.trained}}
          </div>
          
          <button type="button" data-action="rollCheck" data-check-type="skill" data-check-key="{{key}}">
            <i class="fas fa-dice-d20"></i>
          </button>
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- Inventory Tab --}}
    <div class="tab{{#if (eq tabGroups.primary "inventory")}} active{{/if}}" data-group="primary" data-tab="inventory">
      <h2>{{localize "VAGABOND.Tabs.Inventory"}}</h2>
      
      <div class="inventory-slots">
        <label>{{localize "VAGABOND.Inventory.Slots"}}</label>
        <div class="slots-bar">
          <div class="slots-bar-fill" style="width: {{multiply (divide system.slots.used system.slots.max) 100}}%"></div>
          <span class="slots-text">{{system.slots.used}} / {{system.slots.max}}</span>
        </div>
      </div>
      
      {{#if items.weapons}}
      <h3>Weapons</h3>
      <div class="items-list">
        {{#each items.weapons as |item|}}
        <div class="item{{#if item.system.equipped}} equipped{{/if}}" data-item-id="{{item._id}}" draggable="true">
          <div class="item-name" data-action="editItem">
            {{#if item.img}}
            <img src="{{item.img}}" alt="{{item.name}}"/>
            {{/if}}
            <span>{{item.name}}</span>
          </div>
          <div>{{item.system.damage.die}}</div>
          <div>{{item.system.range}}</div>
          <div class="item-controls">
            <button type="button" class="item-control equip" data-action="toggleEquipped" title="Equip/Unequip">
              <i class="fas {{#if item.system.equipped}}fa-check-circle{{else}}fa-circle{{/if}}"></i>
            </button>
            <button type="button" class="item-control delete" data-action="deleteItem" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        {{/each}}
      </div>
      {{/if}}
      
      {{#if items.armor}}
      <h3>Armor</h3>
      <div class="items-list">
        {{#each items.armor as |item|}}
        <div class="item{{#if item.system.equipped}} equipped{{/if}}" data-item-id="{{item._id}}" draggable="true">
          <div class="item-name" data-action="editItem">
            {{#if item.img}}
            <img src="{{item.img}}" alt="{{item.name}}"/>
            {{/if}}
            <span>{{item.name}}</span>
          </div>
          <div>{{localize (concat "VAGABOND.Armor." item.system.type)}}</div>
          <div>{{item.system.rating}}</div>
          <div class="item-controls">
            <button type="button" class="item-control equip" data-action="toggleEquipped" title="Equip/Unequip">
              <i class="fas {{#if item.system.equipped}}fa-check-circle{{else}}fa-circle{{/if}}"></i>
            </button>
            <button type="button" class="item-control delete" data-action="deleteItem" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        {{/each}}
      </div>
      {{/if}}
      
      {{#if items.gear}}
      <h3>Gear</h3>
      <div class="items-list">
        {{#each items.gear as |item|}}
        <div class="item" data-item-id="{{item._id}}" draggable="true">
          <div class="item-name" data-action="editItem">
            {{#if item.img}}
            <img src="{{item.img}}" alt="{{item.name}}"/>
            {{/if}}
            <span>{{item.name}}</span>
          </div>
          <div>{{item.system.slots}}</div>
          <div>{{item.system.quantity}}</div>
          <div class="item-controls">
            <button type="button" class="item-control delete" data-action="deleteItem" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        {{/each}}
      </div>
      {{/if}}
    </div>

    {{!-- Biography Tab --}}
    <div class="tab{{#if (eq tabGroups.primary "biography")}} active{{/if}}" data-group="primary" data-tab="biography">
      <h2>{{localize "VAGABOND.Character.Biography"}}</h2>
      
      <div class="editor">
        {{editor enrichedBiography target="system.biography" button=true editable=editable}}
      </div>
    </div>

  </section>
</form>
